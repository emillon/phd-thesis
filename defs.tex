\newcommand{\irule}[3]{ \inferrule*[right=(#1)]{#2}{#3} }
\def\iaxiom#1#2{\irule{#1}{ }{#2}}

% http://tex.stackexchange.com/questions/3964/mathematical-symbol-for-disjoint-set-union
\makeatletter
\def\moverlay{\mathpalette\mov@rlay}
\def\mov@rlay#1#2{\leavevmode\vtop{%
   \baselineskip\z@skip \lineskiplimit-\maxdimen
   \ialign{\hfil$\m@th#1##$\hfil\cr#2\crcr}}}
\newcommand{\charfusion}[3][\mathord]{
    #1{\ifx#1\mathop\vphantom{#2}\fi
        \mathpalette\mov@rlay{#2\cr#3}
      }
    \ifx#1\mathop\expandafter\displaylimits\fi}
\makeatother

\newcommand{\dcup}{\charfusion[\mathbin]{\cup}{+}}
\newcommand{\bigdcup}{\charfusion[\mathbin]{\bigcup}{+}}

% Fix '::' -> ': :' when using babel
\newenvironment{grammarf}{\shorthandoff{:}\begin{grammar}}{\end{grammar}\shorthandon{:}}

\def\opbin{\boxplus\xspace}
\def\opun{\boxminus\xspace}

\newcommand{\gramisa}[0]{::=~}
\newcommand{\gramor}[0]{|\hspace{3mm}}

\newcommand{\gramlr}[2]{%
  \begin{minipage}{0.2\textwidth}\raggedleft #1\end{minipage}
  \begin{minipage}{0.8\textwidth}#2\end{minipage}
}

% Types
\newcommand{\tInt}{\textsc{Int}\xspace}
\newcommand{\tFloat}{\textsc{Float}\xspace}
\newcommand{\tVoid}{\textsc{Void}\xspace}

\newcommand{\tFV}[1]{\textrm{FreeVars}(#1)}

\def\opxor{\mathbin{\char`\^}}

% Constant
\newcommand{\cNil}{\textsc{Nil}}

% Program & language names
\newcommand{\ctonewspeak}{\textsc{c2newspeak}}
\newcommand{\cpp}{\textsc{cpp}}
\newcommand{\newspeak}{\textsc{Newspeak}}

% Newspeak
\newcommand{\npkIf}[3]{\textsc{If}(#1) \{ #2 \} \textsc{Else} \{ #3 \}}
\newcommand{\npkDoWith}[2]{\textsc{Do}\{ #1 \}\textsc{With}~#2:}
\newcommand{\npkWhile}[1]{\textsc{While}(1)\{#1\}}
\newcommand{\npkGoto}[1]{\textsc{Goto}~#1}
\newcommand{\npkReturn}[1]{\textsc{Return}~#1}

% cML
\def\iPass{\textsc{Pass}\xspace}
\def\iIf#1#2#3{\npkIf{#1}{#2}{#3}}
\def\iWhile#1#2{\textsc{While}(#1)\{#2\}}
\def\iReturn#1{\textsc{Return}(#1)}

\def\iThen#1#2{\textsc{If}(#1) \{ #2 \}}

\def \eNull{\textsc{Null}\xspace}

\def\vRet{\underline{R}}

% sets pour semantique
\def\sId{\textsc{Id}\xspace}
\def\sMem{\textsc{Mem}\xspace}
\def\sAddr{\textsc{Addr}\xspace}
\def\sInt{\textsc{Int}\xspace}
\def\sFloat{\textsc{Float}\xspace}
\def\sPhi{\Phi}

% Memory state (instructions)
% #1 : memory
% #2 : instruction
\def\msi#1#2{ \langle #2, #1 \rangle }

% Reduction (expressions)
\def\mm#1#2#3#4{ \msi{#1}{#2} → \msi{#3}{#4} }

% Reduction (instructions)
\def\mmi#1#2#3#4{ \mm{#1}{#2}{#3}{#4} }

% Reduction (left-values)
\def\mmlv#1#2#3#4{ \mm{#1}{#2}{#3}{#4} }

\def\mmbig#1#2#3#4{
  \left\langle #2, #1 \right\rangle →
  \left\langle #4, #3 \right\rangle
}

% Compatibilité Γ / m
\def\mcomp#1#2{#1 ⊢_{mem} #2}

% Eval de phrase
\def\ph#1#2#3{#1 ⊢ #2 → #3}

\def\phstar#1#2#3{#1 ⊢ #2 →^* #3}

\def\evstar#1#2#3#4{
  \mmbig{#1}{\begin{pmatrix}#2\end{pmatrix}}
        {#3}{\begin{pmatrix}#4\end{pmatrix}}
}

% typage
\def\ty#1#2#3{#1 ⊢ #2 : #3}
\def\tyi#1#2{#1 ⊢ #2}
\def\typh#1#2#3#4#5{#1, #2 ⊢ #3 → #4, #5}
\def\typhstar#1#2#3#4#5{#1, #2 ⊢ #3 →^* #4, #5}

\def\tstruct#1{\mathrm{struct}~#1}

% Continuations
\def\kPass{\textsc{Kpass}\xspace}
\def\kSeq#1#2{\textsc{Kseq}(#1, #2)}
\def\kBlock#1#2{\textsc{Kblock}(#1, #2)}
\def\kCall#1#2#3#4{\textsc{Kcall}(#1, #2, #3, #4)}
\def\kRet#1{\textsc{Kret}(#1)}

\def\sVal{\textsc{Val}}
\def\sByte{\textsc{Byte}}

\def\powerset#1{\mathcal P \left({#1}\right)}

% Functions with placeholders
\def\phx#1{\ensuremath{#1{\cdot}}}
\def\phxx#1{\ensuremath{#1{\cdot}{\cdot}}}

% Progs bien formés
\def\WF#1{\textsc{wf}(#1)}
\def\NORET#1{\textsc{NoRet}(#1)}

\newcommand{\insertcode}[1]{\input{gen/#1.pyg.tex}}

% \chapter* + add to toc
%\newcommand{\chapterstar}[1]{\chapter*{#1} \addcontentsline{toc}{chapter}{#1}}

% Register names
\def\defreg#1{\expandafter\def\csname#1\endcsname{\textsc{#1}\xspace}}

\defreg{eax}
\defreg{ebx}
\defreg{ecx}
\defreg{edx}
\defreg{esi}
\defreg{edi}
\defreg{ebp}
\defreg{esp}
\defreg{eip}
\defreg{eflags}

\def\crtrois{\textsc{CR3}}

\newcommand{\ring}[1]{\emph{ring}~#1}

\newcommand{\asminstr}[1]{\texttt{#1}}

\newcommand{\wip}[0]{%
%\begin{center}
    %\includegraphics[width=5cm]{gen/travaux.pdf}
%\end{center}
\textbf{(wip)}
}

\newcommand{\listcons}[0]{%
\texttt{(::)}%
}

\newcommand{\hexa}[1]{%
\texttt{0x#1}%
}

% Debug tikz bounding box
\def\drawbb{\draw[thick] (current bounding box.south west) rectangle (current bounding box.north east);}

% SubFloat + verbatim
\makeatletter
\newbox\sf@box
\newenvironment{SubFloat}[2][]%
{\def\sf@one{#1}%
\def\sf@two{#2}%
\setbox\sf@box\hbox
\bgroup}%
{ \egroup
\ifx\@empty\sf@two\@empty\relax
\def\sf@two{\@empty}
\fi
\ifx\@empty\sf@one\@empty\relax
\subfloat[\sf@two]{\box\sf@box}%
\else
\subfloat[\sf@one][\sf@two]{\box\sf@box}%
\fi}
\makeatother

% comes from the memoir manual {{{

\newcommand*{\addtotextheight}[1]{%
\twocolumn
\addtolength{\textheight}{#1}%
\onecolumn}

%% for main body, bottom of text at 1in, footer below
%% top of header at 1in, first text line double spaced
%% below base of header
\newlength{\linespace}
\setlength{\linespace}{\baselineskip} % current equivalent of \onelineskip
\setlength{\headheight}{\onelineskip}
\setlength{\headsep}{\linespace}
\addtolength{\headsep}{-\topskip}
\setlength{\uppermargin}{1in}
\addtolength{\uppermargin}{\headheight}
\addtolength{\uppermargin}{\headsep}

%% and for the bottom
\setlength{\lowermargin}{1in}
\setlength{\textheight}{\paperheight}

\addtolength{\textheight}{-\uppermargin}
\addtolength{\textheight}{-\lowermargin}
%% footnote settings
\setlength{\footskip}{\onelineskip}
\setlength{\footnotesep}{\onelineskip}


%% the fiddle lengths (..ta.. for title/approval page, others for prelims)
\newlength{\toptafiddle} \setlength{\toptafiddle}{2\linespace}
\newlength{\bottafiddle} \setlength{\bottafiddle}{0pt}
\newlength{\topfiddle}
\setlength{\topfiddle}{\toptafiddle}
\newlength{\botfiddle}
\setlength{\botfiddle}{\onelineskip}

%%% general macro for Abstract, etc., headings
\newcommand*{\pretoctitle}[1]{{\clearpage\centering \vspace*{-\topfiddle}#1\par}}

%%% Start the ACKNOWLEDGEMENTS
\newcommand{\asuacknowledgements}{\pretoctitle{ACKNOWLEDGEMENTS}}

%%% Start the ABSTRACT
\newcommand{\asuabstract}{ \addtotextheight{-\botfiddle} \pretoctitle{ABSTRACT}}

\addtodef{\mainmatter}{\addtotextheight{\botfiddle}{}}

%% make it easy to center any dedication
\newcommand{\asudedication}[1]{%
{\clearpage\mbox{}\vfill\centering #1 \par\vfill\clearpage}}

% }}} /memoir

% {{{ subtitle command
\newcommand\subtitle[1]{%
  \newcommand\thesubtitle{#1}}
% }}}

% switch {{{
\def\switch#1#2{
  \ifstrequal{#2}{END}{
    \errmessage{switch : case "#1" not found}
  }{
    \switchnext{#1}{#2}
  }
}

\def\switchnext#1#2#3{
  \ifstrequal{#1}{#2}
    {#3\switchlast}
    {
      \switch{#1}
    }
}

\def\switchlast#1{
  \ifstrequal{#1}{END}{}
  {\switchlast}
}
% }}}
