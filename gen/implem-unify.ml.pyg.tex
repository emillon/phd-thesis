\begin{Verbatim}[commandchars=\\\{\}]
\PY{k}{let} \PY{k}{rec} \PY{n}{unify\PYZus{}now} \PY{n}{ta} \PY{n}{tb} \PY{o}{=}
  \PY{k}{let} \PY{n}{sta} \PY{o}{=} \PY{n}{shorten} \PY{n}{ta} \PY{k}{in}
  \PY{k}{let} \PY{n}{stb} \PY{o}{=} \PY{n}{shorten} \PY{n}{tb} \PY{k}{in}
  \PY{k}{match} \PY{o}{(}\PY{n}{sta}\PY{o}{,} \PY{n}{stb}\PY{o}{)} \PY{k}{with}
  \PY{o}{|} \PY{o}{(}\PY{o}{(}\PY{n+nc}{Var} \PY{o}{(}\PY{o}{\PYZob{}}\PY{n}{contents} \PY{o}{=} \PY{n+nc}{Unknown} \PY{n}{na}\PY{o}{\PYZcb{}} \PY{k}{as} \PY{n}{ra}\PY{o}{)}\PY{o}{)}\PY{o}{,}
     \PY{o}{(}\PY{n+nc}{Var}  \PY{o}{\PYZob{}}\PY{n}{contents} \PY{o}{=} \PY{n+nc}{Unknown} \PY{n}{nb}\PY{o}{\PYZcb{}}\PY{o}{)}\PY{o}{)} \PY{o}{-\PYZgt{}}
       \PY{k}{begin}
         \PY{k}{if} \PY{n}{na} \PY{o}{\PYZlt{}}\PY{o}{\PYZgt{}} \PY{n}{nb} \PY{k}{then}
           \PY{n}{ra} \PY{o}{:=} \PY{n+nc}{Instanciated} \PY{n}{stb}
       \PY{k}{end}
  \PY{o}{|} \PY{o}{(}\PY{o}{(}\PY{n+nc}{Var} \PY{o}{(}\PY{o}{\PYZob{}}\PY{n}{contents} \PY{o}{=} \PY{n+nc}{Unknown} \PY{o}{\PYZob{}}\PY{n}{id} \PY{o}{=} \PY{n}{n}\PY{o}{\PYZcb{}}\PY{o}{\PYZcb{}} \PY{k}{as} \PY{n}{r}\PY{o}{)}\PY{o}{)}\PY{o}{,} \PY{n}{t}\PY{o}{)}
    \PY{o}{-\PYZgt{}}
      \PY{k}{begin}
        \PY{k}{if} \PY{n}{occurs} \PY{n}{n} \PY{n}{t} \PY{k}{then}
          \PY{n}{occurs\PYZus{}check\PYZus{}failed} \PY{n}{sta} \PY{n}{stb}
        \PY{k}{else}
          \PY{n}{r} \PY{o}{:=} \PY{n+nc}{Instanciated} \PY{n}{t}
      \PY{k}{end}
  \PY{o}{|} \PY{o}{(}\PY{o}{\PYZus{}}\PY{o}{,} \PY{o}{(}\PY{n+nc}{Var} \PY{o}{(}\PY{o}{\PYZob{}}\PY{n}{contents} \PY{o}{=} \PY{n+nc}{Unknown} \PY{o}{\PYZus{}}\PY{o}{\PYZcb{}}\PY{o}{)}\PY{o}{)}\PY{o}{)} \PY{o}{-\PYZgt{}} \PY{n}{unify\PYZus{}now} \PY{n}{stb} \PY{n}{sta}

  \PY{o}{|} \PY{n+nc}{Int}\PY{o}{,} \PY{n+nc}{Int}
  \PY{o}{|} \PY{n+nc}{Float}\PY{o}{,} \PY{n+nc}{Float} \PY{o}{-\PYZgt{}} \PY{n+nb+bp}{()}

  \PY{o}{|} \PY{n+nc}{Ptr} \PY{o}{(}\PY{n}{qa}\PY{o}{,} \PY{n}{ta}\PY{o}{)}\PY{o}{,} \PY{n+nc}{Ptr} \PY{o}{(}\PY{n}{qb}\PY{o}{,} \PY{n}{tb}\PY{o}{)} \PY{o}{-\PYZgt{}}
      \PY{n}{unify\PYZus{}quals} \PY{n}{qa} \PY{n}{qb}\PY{o}{;}
      \PY{n}{unify\PYZus{}now} \PY{n}{ta} \PY{n}{tb}

  \PY{o}{|} \PY{n+nc}{Array} \PY{n}{a}\PY{o}{,} \PY{n+nc}{Array} \PY{n}{b} \PY{o}{-\PYZgt{}} \PY{n}{unify\PYZus{}now} \PY{n}{a} \PY{n}{b}

  \PY{o}{|} \PY{n+nc}{Fun} \PY{o}{(}\PY{n}{args\PYZus{}a}\PY{o}{,} \PY{n}{rets\PYZus{}a}\PY{o}{)}\PY{o}{,} \PY{n+nc}{Fun} \PY{o}{(}\PY{n}{args\PYZus{}b}\PY{o}{,} \PY{n}{rets\PYZus{}b}\PY{o}{)} \PY{o}{-\PYZgt{}}
      \PY{n+nn}{List}\PY{p}{.}\PY{n}{iter2} \PY{n}{unify\PYZus{}now} \PY{n}{args\PYZus{}a} \PY{n}{args\PYZus{}b}\PY{o}{;}
      \PY{n+nn}{List}\PY{p}{.}\PY{n}{iter2} \PY{n}{unify\PYZus{}now} \PY{n}{rets\PYZus{}a} \PY{n}{rets\PYZus{}b}

  \PY{o}{|} \PY{n+nc}{Struct} \PY{n}{rfa}\PY{o}{,} \PY{n+nc}{Struct} \PY{n}{rfb} \PY{o}{-\PYZgt{}}
      \PY{n}{unify\PYZus{}structs} \PY{n}{rfa} \PY{n}{rfb}

  \PY{o}{|} \PY{o}{\PYZus{}} \PY{o}{-\PYZgt{}} \PY{n}{type\PYZus{}clash} \PY{n}{sta} \PY{n}{stb}
\end{Verbatim}
