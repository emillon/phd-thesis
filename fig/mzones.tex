\def\memoryframe#1{%
\begin{tikzpicture}
  [user/.style={fill=green!40}
  ,kernel/.style={fill=red!40}
  ]

  % Fig memory zones (needed ?)
  % Memory zone
  %
  % ##1 - start
  % ##2 - end
  % ##3 - color
  \def\mzone##1##2##3{
    \path[##3] (##1,0) rectangle (##2,1);
  }

  % Address label
  %
  % ##1 - x position
  % ##2 - text
  \def\alabel##1##2{
    \path (##1,1) -- ++(0,0.3) node [pos=1] {\small \ttfamily ##2};

  }

  % Pointer
  %
  % ##1 - start address
  % ##2 - label
  \def\ptr##1##2{
    \path [draw,open triangle 60-] (##1, -0.2) -- ++ (0,-0.5) node [below] {##2};
  }

  % exec
  \mzone{0.5}{1}{user}

  % lib
  \mzone{2.5}{3.2}{user}

  % stack
  \mzone{3.7}{4}{user}

  % stack
  \mzone{5}{5.5}{user}

  % kernel
  \mzone{6}{8}{kernel}

  % contour
  \draw (0,0) rectangle (8,1);

  \alabel{0}{0}
  \alabel{6}{3 Go}
  \alabel{8}{4 Go}

  % User struct
  \ifthenelse{#1=1}{\mzone{2.6}{3.1}{draw, fill=green}}{}
  \ifthenelse{#1=1}{\ptr{2.6}{pu}}{}

  \ifthenelse{#1=2}{\mzone{7}{7.5}{draw, fill=red}}{}
  \ifthenelse{#1>1}{\ptr{7}{pk}}{}

\end{tikzpicture}
} % End of newcommand \memoryframe

